<model-meta
	name="chatMessage"
	type="event">

	<fields>

		<!-- id -->

		<generated-id-field/>

		<!-- identity -->

		<parent-field
			type="chatContact"
			cacheable="yes"/>

		<index-field
			cacheable="yes"/>

		<!-- data -->

		<reference-field
			type="chat"/>

		<reference-field
			name="fromUser"
			type="chatUser"/>

		<reference-field
			name="toUser"
			type="chatUser"/>

		<!-- timings -->

		<timestamp-field
			name="timestamp"
			column-type="postgresql"/>

		<timestamp-field
			name="moderatorTimestamp"
			column-type="postgresql"
			nullable="yes"/>

		<integer-field
			name="threadId"
			nullable="yes"/>

		<enum-field
			name="source"
			type="chatMessageMethod"
			nullable="yes"/>

		<enum-field
			name="method"
			type="chatMessageMethod"
			default="sms"/>

		<reference-field
			name="originalText"
			type="text"/>

		<reference-field
			name="editedText"
			type="text"
			nullable="yes"/>

		<yes-no-field
			name="monitorWarning"
			default="no"/>

		<reference-field
			name="sender"
			type="user"
			column="sender_user_id"
			nullable="yes"/>

		<reference-field
			name="moderator"
			type="user"
			column="moderator_user_id"
			nullable="yes"/>

		<!-- state -->

		<enum-field
			name="status"
			type="chatMessageStatus"/>

		<reference-field
			type="queueItem"
			nullable="yes"/>

		<integer-field
			name="deliveryId"
			nullable="yes"/>

		<yes-no-field
			name="finalMessage"
			column="final"
			nullable="yes"/>

	</fields>

	<collections>

		<associative-list
			name="medias"
			type="media"
			table="chat_message_media"
			owned="yes"/>

	</collections>

</model-meta>